local player = game:GetService("Players").LocalPlayer
local uis = game:GetService("UserInputService")

-- Tunggu PlayerGui tersedia
local playerGui = player:WaitForChild("PlayerGui")

-- Hapus GUI lama jika ada
if playerGui:FindFirstChild("KONTOL TESTER") then
    playerGui:FindFirstChild("KONTOL TESTER"):Destroy()
end

local gui = Instance.new("ScreenGui")
gui.Name = "KONTOL TESTER"
gui.ResetOnSpawn = false
gui.Parent = playerGui

-- FRAME UTAMA
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 120)
frame.Position = UDim2.new(0.3, 0, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = gui

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 10)
frameCorner.Parent = frame

local stroke = Instance.new("UIStroke")
stroke.Thickness = 2
stroke.Color = Color3.fromRGB(255, 0, 255)
stroke.Parent = frame

-- JUDUL
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -40, 0, 40)
title.Position = UDim2.new(0, 10, 0, 5)
title.Text = "MEKI"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = frame

-- WARNA-WARNI JUDUL
spawn(function()
    while wait(0.1) do
        if title and title.Parent then
            title.TextColor3 = Color3.fromHSV((tick() * 0.5) % 1, 1, 1)
        end
    end
end)

-- MINIMIZE
local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -35, 0, 5)
minBtn.Text = "-"
minBtn.Font = Enum.Font.GothamBold
minBtn.TextSize = 18
minBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minBtn.BackgroundColor3 = Color3.fromRGB(80, 0, 80)
minBtn.Parent = frame

local minBtnCorner = Instance.new("UICorner")
minBtnCorner.CornerRadius = UDim.new(0, 8)
minBtnCorner.Parent = minBtn

local isMinimized = false
minBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    for _, obj in pairs(frame:GetChildren()) do
        if obj:IsA("GuiObject") and obj ~= title and obj ~= minBtn then
            obj.Visible = not isMinimized
        end
    end
    frame.Size = isMinimized and UDim2.new(0, 300, 0, 50) or UDim2.new(0, 300, 0, 120)
end)

-- TOGGLE BUTTON
local toggle = Instance.new("TextButton")
toggle.Size = UDim2.new(0.9, 0, 0, 40)
toggle.Position = UDim2.new(0.05, 0, 0, 60)
toggle.Text = "Teleport OFF"
toggle.Font = Enum.Font.GothamBold
toggle.TextSize = 16
toggle.BackgroundColor3 = Color3.fromRGB(60, 0, 90)
toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
toggle.Parent = frame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggle

local isActive = false
local humanoidRootPart = nil
local humanoid = nil

-- KOORDINAT TELEPORT
local coords = {
    Vector3.new(136, 143, -175),
    Vector3.new(326, 88, -433),
    Vector3.new(476, 169, -940),
    Vector3.new(930, 134, -626),
    Vector3.new(923, 101, 279),
    Vector3.new(266, 325, 711),
}

-- UPDATE CHARACTER REFERENCES
local function updateCharacterRefs()
    if player.Character then
        humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
        humanoid = player.Character:FindFirstChild("Humanoid")
        return humanoidRootPart and humanoid
    end
    return false
end

-- INITIAL UPDATE
updateCharacterRefs()

-- HANDLE CHARACTER RESPAWN
player.CharacterAdded:Connect(function(character)
    wait(1) -- Tunggu character fully loaded
    updateCharacterRefs()
end)

-- TELEPORT LOOP
spawn(function()
    while true do
        wait(2)
        if isActive then
            if not updateCharacterRefs() then
                wait(1)
                continue
            end
            
            -- Teleport through all coordinates
            for i, pos in pairs(coords) do
                if not isActive then break end
                
                if updateCharacterRefs() then
                    humanoidRootPart.CFrame = CFrame.new(pos)
                    print("Teleported to position " .. i)
                end
                
                wait(2)
            end
            
            -- Task 7: Kill and respawn
            if isActive and updateCharacterRefs() then
                print("Cycle complete - respawning...")
                humanoid.Health = 0
                
                -- Wait for respawn
                player.CharacterAdded:Wait()
                wait(3) -- Extra wait for full respawn
                updateCharacterRefs()
                print("Respawned - new cycle starting")
            end
